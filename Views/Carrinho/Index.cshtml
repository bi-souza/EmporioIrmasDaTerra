@model List<EmporioIrmasDaTerra.Models.CartItem>
@{
    ViewData["Title"] = "Carrinho";
    // Total enviado pelo Controller via ViewBag
    decimal total = ViewBag.Total is decimal d ? d : 0m;
}

<div class="container mt-4">
    <h2>Carrinho</h2>
@* Exibe mensagem de sucesso da compra *@
    @if (TempData["Msg"] != null)
{
    <div class="alert alert-success">
        @TempData["Msg"]
    </div>
}


    @* Se não há itens, mostra mensagem e um link pra voltar *@
    @if (!Model.Any())
    {
        <p>Seu carrinho está vazio.</p>
        <a class="btn btn-primary" href="@Url.Action("Index","Home")">Voltar às compras</a>
    }
    else
    {
        <table class="table">
            <thead>
                <tr>
                    <th>Produto</th>
                    <th>Preço</th>
                    <th>Qtd</th>
                    <th>Subtotal</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
            @foreach (var item in Model)
            {
                // Subtotal calculado na View (bem simples)
                var subtotal = item.PrecoUnitario * item.Quantidade;
                <tr>
                    <td>@item.Nome</td>
                    <td>@item.PrecoUnitario.ToString("C")</td>
                    <td>
                        @* Form pra atualizar a quantidade desse item *@
                        <form asp-action="Atualizar" method="post" class="d-flex gap-2">
                            <input type="hidden" name="id" value="@item.IdProduto" />
                            <input type="number" name="qtd" value="@item.Quantidade" min="1" class="form-control" style="width:90px" />
                            <button class="btn btn-sm btn-secondary" type="submit">OK</button>
                        </form>
                    </td>
                    <td>@subtotal.ToString("C")</td>
                    <td>
                        @* Form pra remover esse item *@
                        <form asp-action="Remover" method="post">
                            <input type="hidden" name="id" value="@item.IdProduto" />
                            <button class="btn btn-sm btn-danger">Remover</button>
                        </form>
                    </td>
                </tr>
            }
            </tbody>
            <tfoot>
                <tr>
                    <th colspan="3" class="text-end">Total</th>
                    <th>@total.ToString("C")</th>
                    <th></th>
                </tr>
            </tfoot>
        </table>

        @* Botão bem simples para "finalizar compra" (só limpa e mostra mensagem) *@
        <form asp-action="FinalizarCompra" method="post" class="mt-2">
            <button class="btn btn-success">Finalizar compra</button>
        </form>
    }
</div>
